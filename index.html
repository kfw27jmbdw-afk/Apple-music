<!DOCTYPE html>
<html>
<head>
    <title>ï£¿ Test Player v9</title>
    <style>
        body { background: #000; color: #fff; font-family: -apple-system, sans-serif; text-align: center; padding: 50px; }
        .controls { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        button { background: #1c1c1e; color: white; border: 1px solid #333; padding: 15px 25px; border-radius: 12px; cursor: pointer; font-weight: bold; }
        #status { color: #ff375f; font-size: 14px; margin-top: 15px; font-family: monospace; }
        .version { position: fixed; bottom: 10px; right: 10px; font-size: 10px; color: #555; }
    </style>
</head>
<body>

    <h2 id="title">ï£¿ Zero-Gap Bridge</h2>
    <div id="status">V9: INITIALIZING...</div>

    <div class="controls">
        <button onclick="prev()">BACK</button>
        <button id="playBtn" onclick="togglePlay()">PLAY</button>
        <button onclick="next()">NEXT</button>
    </div>

    <div class="version">Build Version: 9.0.0</div>

<script>
    const playlist = [
        { name: "Song 1", url: "https://dl.dropboxusercontent.com/scl/fi/br3g44trm44skzqkimd03/2-Gulaab.mp3?rlkey=m5rjmhrb9whv8jvwh90nx96zl&st=v2c7itu2&raw=1" }, 
        { name: "Song 2", url: "https://dl.dropboxusercontent.com/scl/fi/br3g44trm44skzqkimd03/2-Gulaab.mp3?rlkey=m5rjmhrb9whv8jvwh90nx96zl&st=v2c7itu2&raw=1" }
    ];

    let currentIndex = 0;
    
    // ðŸŸ¢ DUAL PLAYER STRATEGY
    let playerA = new Audio();
    let playerB = new Audio();
    let currentPlayer = playerA;
    let nextPlayer = playerB;

    function resolveURL(input) {
        if (input.startsWith("http")) return input;
        try { return atob(input); } catch(e) { return input; }
    }

    async function switchSong(index) {
        currentIndex = index;
        const s = playlist[index];
        const url = resolveURL(s.url);

        document.getElementById('status').innerText = "CROSSFADING...";

        // 1. Current player ko pause karo
        currentPlayer.pause();
        
        // 2. Swapping: Next player ab main player ban jayega
        let temp = currentPlayer;
        currentPlayer = nextPlayer;
        nextPlayer = temp;

        // 3. New Player Playback (Jo pehle se standby par tha)
        currentPlayer.src = url; 
        setupMediaSession(s.name);
        
        try {
            await currentPlayer.play();
            document.getElementById('title').innerText = s.name;
            document.getElementById('status').innerText = "PLAYING (v9 ZERO-GAP)";
            
            // 4. PRE-LOAD NEXT: Agle gaane ko standby player par load karke rakho
            prepareNextPlayer();
        } catch (e) {
            document.getElementById('status').innerText = "TAP TO START";
        }
    }

    function prepareNextPlayer() {
        let nextIdx = (currentIndex + 1) % playlist.length;
        let nextURL = resolveURL(playlist[nextIdx].url);
        
        // Standby player ko agle gaane ke liye "Warm" karna
        nextPlayer.src = nextURL;
        nextPlayer.preload = "auto";
        nextPlayer.load(); 
        console.log("ï£¿ Bridge: Standby player ready for next track.");
    }

    function setupMediaSession(songName) {
        if ('mediaSession' in navigator) {
            navigator.mediaSession.metadata = new MediaMetadata({ title: songName, artist: "ï£¿ Music v9" });
            navigator.mediaSession.setActionHandler('play', () => currentPlayer.play());
            navigator.mediaSession.setActionHandler('pause', () => currentPlayer.pause());
            navigator.mediaSession.setActionHandler('nexttrack', () => next());
            navigator.mediaSession.setActionHandler('previoustrack', () => prev());
        }
    }

    function togglePlay() { currentPlayer.paused ? currentPlayer.play() : currentPlayer.pause(); }
    function next() { switchSong((currentIndex + 1) % playlist.length); }
    function prev() { switchSong((currentIndex - 1 + playlist.length) % playlist.length); }

    // UI Sync for Active Player
    setInterval(() => {
        document.getElementById('playBtn').innerText = currentPlayer.paused ? "PLAY" : "PAUSE";
    }, 200);

    // Initial Load
    window.onload = () => { switchSong(0); };
</script>
</body>
</html>
