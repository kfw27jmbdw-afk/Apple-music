<!DOCTYPE html>
<html>
<head>
    <title>ï£¿ Test Player</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; padding: 50px; }
        .controls { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        button { background: #1c1c1e; color: white; border: 1px solid #333; padding: 15px 25px; border-radius: 10px; cursor: pointer; }
        #status { color: #8e8e93; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>

    <h2 id="title">Loading...</h2>
    <div id="status">Paused</div>

    <div class="controls">
        <button onclick="prev()">Back</button>
        <button id="playBtn" onclick="togglePlay()">Play</button>
        <button onclick="next()">Next</button>
    </div>

<script>
    // 1. Tera Encoded Dropbox Data
    const playlist = [
        { name: "Song 1", url: "aHR0cHM6Ly9kbC5kcm9wYm94dXNlcmNvbnRlbnQuY29tL3NjbC9maS9wOWJnbHprbTd2aGlwZXR1bWh4ZXUvVGVyZS1CaW5hLUd1cnUtMzIwLUticHMubXAzP3Jsa2V5PThyNXNhMm1yZnVreTN5Z2IwZ21jdXpxcTImc3Q9bXFjOGdkMjImcmF3PTE=" }, 
        { name: "Song 2", url: "aHR0cHM6Ly9kbC5kcm9wYm94dXNlcmNvbnRlbnQuY29tL3NjbC9maS9wOWJnbHprbTd2aGlwZXR1bWh4ZXUvVGVyZS1CaW5hLUd1cnUtMzIwLUticHMubXAzP3Jsa2V5PThyNXNhMm1yZnVreTN5Z2IwZ21jdXpxcTImc3Q9bXFjOGdkMjImcmF3PTE=" }
    ];

    let currentIndex = 0;
    let audio = new Audio();

    function loadSong(index) {
        currentIndex = index;
        const s = playlist[index];
        document.getElementById('title').innerText = s.name;

        // 2. Base64 Decode Logic
        let decodedURL = atob(s.url);
        
        // Lockscreen Fix: Source set karne se pehle purana audio clear karo
        audio.pause();
        audio.src = decodedURL;
        audio.load();
        
        // 3. Media Session Setup (Lockscreen Fix)
        if ('mediaSession' in navigator) {
            navigator.mediaSession.metadata = new MediaMetadata({ title: s.name });
            
            // Ye handlers lockscreen buttons ko control karte hain
            navigator.mediaSession.setActionHandler('play', () => { audio.play(); });
            navigator.mediaSession.setActionHandler('pause', () => { audio.pause(); });
            navigator.mediaSession.setActionHandler('previoustrack', () => { prev(); });
            navigator.mediaSession.setActionHandler('nexttrack', () => { next(); });
        }

        audio.play().catch(e => console.log("User interaction needed"));
    }

    function togglePlay() {
        if (audio.paused) { audio.play(); } 
        else { audio.pause(); }
    }

    function next() { 
        currentIndex = (currentIndex + 1) % playlist.length; 
        loadSong(currentIndex); 
    }

    function prev() { 
        currentIndex = (currentIndex - 1 + playlist.length) % playlist.length; 
        loadSong(currentIndex); 
    }

    // Status Update
    audio.onplay = () => { 
        document.getElementById('status').innerText = "Playing...";
        document.getElementById('playBtn').innerText = "Pause";
    };
    audio.onpause = () => { 
        document.getElementById('status').innerText = "Paused";
        document.getElementById('playBtn').innerText = "Play";
    };

    // Auto-load first song
    loadSong(0);
</script>
</body>
</html>
