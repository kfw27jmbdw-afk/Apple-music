<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Apple Music</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1DB954">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<div id="download-progress-container">
    <div id="download-progress-bar"></div>
</div>

<div id="intro-screen" style="position: fixed; inset: 0; background: #000; display: flex; justify-content: center; align-items: center; z-index: 999999; transition: opacity 0.8s ease;">
    <div style="display: flex; align-items: center;">
        <svg class="apple-logo-svg" viewBox="0 0 384 512" style="width: 60px; height: 60px; fill: white; opacity: 0; transform: scale(0.5); animation: appleAppear 0.8s ease forwards, appleMoveLeft 0.6s cubic-bezier(0.25, 1, 0.5, 1) 1.5s forwards;">
            <path d="M318.7 268.7c-.2-36.7 16.4-64.4 50-84.8-18.8-26.9-47.2-41.7-84.7-44.6-35.5-2.8-74.3 20.7-88.5 20.7-15 0-49.4-19.7-76.4-19.7C63.3 141.2 4 184.8 4 273.5q0 39.3 14.4 81.2c12.8 36.7 59 126.7 107.2 125.2 25.2-.6 43-17.9 75.8-17.9 31.8 0 48.3 17.9 76.4 17.9 48.6-.7 90.4-82.5 102.6-119.3-65.2-30.7-61.7-90-61.7-91.9zm-56.6-164.2c27.3-32.4 24.8-61.9 24-72.5-24.1 1.4-52 16.4-67.9 34.9-17.5 19.8-27.8 44.3-25.6 71.9 26.1 2 49.9-11.4 69.5-34.3z"/>
        </svg>
        <div class="music-text" style="font-size: 50px; font-weight: 700; color: white; letter-spacing: -1.5px; width: 0; opacity: 0; overflow: hidden; white-space: nowrap; animation: musicReveal 0.6s cubic-bezier(0.25, 1, 0.5, 1) 1.5s forwards; font-family: -apple-system, sans-serif;">Music</div>
    </div>
</div>

<div id="main-app">
    <div id="home-screen" class="tab-content" style="display:none;">
        <div class="playlist-header">
            <h2>Home</h2>
        </div>
        <div id="recent-played-container"></div>
    </div>

    <div id="library-screen" class="tab-content" style="display:none;">
        <div class="playlist-header">
            <h2>Library</h2>
        </div>
        <div class="library-sub-nav">
            <button class="sub-nav-btn active" onclick="switchLibraryView('down')">DOWNLOADED</button>
            <button class="sub-nav-btn" onclick="switchLibraryView('playlists')">PLAYLIST</button>
            <button class="sub-nav-btn" onclick="switchLibraryView('fav')">FAVORITE</button>
            <button class="sub-nav-btn" onclick="switchLibraryView('all')">ALBUM</button>
        </div>
        <div id="library-content-area">
            <div id="downloaded-list-container"></div>
        </div>
    </div>

       <div id="playlist-screen" class="tab-content">
        <div class="playlist-header">
            <h2>Your Library</h2>
            <div class="header-icons">
    <i class="fas fa-plus" onclick="document.getElementById('direct-local-import').click()"></i>
</div>

        </div>
        <div id="song-list-container"></div>
    </div>


    <div id="player-screen">
        <div class="drag-handle" id="drag-area">
            <div class="handle-bar"></div>
        </div>
        
        <div class="top-bar">
            <i class="fas fa-chevron-down" onclick="minimizePlayer()"></i>
            <span id="nav-playlist-name">Now Playing</span>
            <i class="fas fa-ellipsis-h" onclick="toggleMenu()"></i>
            
            <div id="side-menu" class="hidden-menu">
                <label for="cover-upload" style="cursor:pointer; display:block; padding: 5px 0;">
                    <i class="fas fa-image"></i> Change Album
                </label>
                <input type="file" id="cover-upload" accept="image/*" style="display:none">
                <hr style="border:0.1px solid #555; margin:5px 0;">
                <div onclick="openForm()" style="cursor:pointer; padding: 5px 0;">
                    <i class="fas fa-link"></i> Add Song Link
                </div>
            </div>
        </div>

        <div class="player-content">
            <div class="banner-container">
                <img src="" id="song-image" crossorigin="anonymous">
            </div>

         <div class="song-info-area">
    <div class="meta">
        <h2 id="player-title"> Music</h2>
        <p id="player-artist">Ready to play</p>
    </div>
    
    <div class="plus-action-wrapper" style="position: relative; z-index: 10000;">
        <i class="fas fa-plus-circle plus-btn" 
           id="like-btn" 
           style="cursor: pointer; font-size: 28px;" 
           onclick="document.getElementById('direct-local-import').click()">
        </i>
        
        <input type="file" id="direct-local-import" 
       accept=".mp3,audio/mpeg,audio/mp3,audio/wav,audio/x-m4a,audio/*,.m4a,.wav" 
       style="display:none" 
       onchange="importLocalSong(this)">

    </div>
</div>

            <div class="controls-wrapper">
                <input type="range" id="seek-bar" value="0" step="0.1" oninput="seekSong()">
                <div class="time-stamps">
                    <span id="current">0:00</span>
                    <span id="duration">0:00</span>
                </div>
                <div class="main-controls">
                    <i class="fas fa-random"></i>
                    <i class="fas fa-step-backward" onclick="prevSong()"></i>
                    <div class="play-trigger" onclick="togglePlay()">
                        <i class="fas fa-play" id="play-btn"></i>
                    </div>
                    <i class="fas fa-step-forward" onclick="nextSong()"></i>
                    <i class="fas fa-redo-alt"></i>
                </div>
            </div>
        </div>
    </div>

    <div id="mini-player" onclick="maximizePlayer()">
        <div class="mini-left">
            <img src="" id="mini-img">
            <div class="mini-meta">
                <h4 id="mini-title">Title</h4>
                <p id="mini-artist">Artist</p>
            </div>
        </div>
        <div class="mini-right">
            <i class="fas fa-play" id="mini-play-btn" onclick="event.stopPropagation(); togglePlay();"></i>
        </div>
    </div>

    <div id="bottom-navigation-container">
        <div id="tab-stack" class="nav-stack">
            <div class="nav-item active" id="tab-home" onclick="switchTab('home')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </div>
            <div class="nav-item" id="tab-browse" onclick="switchTab('all-songs')">
                <i class="fas fa-th-large"></i>
                <span>Browse</span>
            </div>
            <div class="nav-item" id="tab-library" onclick="switchTab('library')">
                <i class="fas fa-play-circle"></i>
                <span>Library</span>
            </div>
            <div class="nav-item" onclick="openSearchStack()">
                <i class="fas fa-search"></i>
                <span>Search</span>
            </div>
        </div>

        <div id="search-stack" class="nav-stack" style="display: none; position: relative;">
            <div class="search-active-tab" id="current-active-indicator">
                <i class="fas fa-home"></i>
            </div>
            <div class="search-input-wrapper" style="position: relative;">
                <i class="fas fa-search search-inside-icon"></i>
                <input type="text" id="app-search-input" placeholder="Search Songs..." oninput="filterSongs()" autocomplete="off">
            </div>
        </div>
        
        <div id="global-search-results" style="display: none; position: fixed; bottom: 85px; left: 12px; right: 12px; background: #1c1c1e; z-index: 999999; max-height: 60vh; overflow-y: auto; border-radius: 20px; border: 1px solid #333; box-shadow: 0 -15px 35px rgba(0,0,0,0.8);"></div>

        <div id="search-backdrop"></div>
    </div>

    <audio id="main-audio" preload="metadata"></audio>
</div>

<div id="action-modal" class="overlay" style="display:none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="modal-song-name">Song Name</h3>
            <p id="modal-song-artist">Artist Name</p>
        </div>
        <div class="modal-options-list">
            <div class="modal-option" onclick="toggleTick('library')">
                <i class="fas fa-plus-square"></i>
                <span>Add to Library</span>
                <i class="fas fa-check-circle tick-icon" id="tick-library"></i>
            </div>
            <div class="modal-option" onclick="toggleTick('favourite')">
                <i class="fas fa-heart"></i>
                <span>Add to Favourite</span>
                <i class="fas fa-check-circle tick-icon" id="tick-favourite"></i>
            </div>
            <hr class="modal-divider">
            <div id="modal-playlists-list"></div>
            <div class="modal-option create-new" onclick="showNewPlaylistPrompt()">
                <i class="fas fa-plus-circle"></i>
                <span>New Playlist...</span>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-done" onclick="saveAndCloseModal()">DONE</button>
        </div>
    </div>
</div>

<div id="playlist-name-modal" class="overlay" style="display:none; z-index: 20005;">
    <div class="modal-content small">
        <h3>New Playlist</h3>
        <input type="text" id="new-playlist-input" placeholder="Playlist Name...">
        <div class="modal-footer">
            <button class="btn-outline" onclick="closePlaylistPrompt()">Cancel</button>
            <button class="btn-green" onclick="confirmCreatePlaylist()">DONE</button>
        </div>
    </div>
</div>

<div id="song-options-menu" class="song-context-menu">
    <div class="menu-item" onclick="handleMenuAddPlaylist()">
        <i class="fas fa-plus"></i> Add to Playlist
    </div>
    <div id="download-toggle-btn" class="menu-item" onclick="handleDownload()">
        <i class="fas fa-arrow-down"></i> Download
    </div>
    <div class="menu-item" onclick="handleMenuChangeCover()">
        <i class="fas fa-image"></i> Change Cover
    </div>
</div>

    <script src="script.js"></script>
    <script>
        // 1. SMART INTRO CONTROL
        window.addEventListener('load', () => {
            const intro = document.getElementById('intro-screen');
            const mainApp = document.getElementById('main-app');

            // Kam se kam 3 second ka wait ( Music animation poora hone ke liye)
            setTimeout(() => {
                if(intro) {
                    intro.style.opacity = '0'; // Parda fade hoga
                    
                    setTimeout(() => {
                        intro.style.display = 'none'; // Intro ko hatao
                        if(mainApp) {
                            mainApp.style.opacity = '1';  // Player reveal
                            mainApp.style.pointerEvents = 'auto'; // Touch enable
                        }
                    }, 800); // 0.8s transition time
                }
            }, 3000); 

            // 2. SERVICE WORKER REGISTRATION
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                .then(() => console.log(" Service Worker Registered"))
                .catch(err => console.log("SW Error:", err));
            }
        });
    </script>
</body>
</html>

