<!DOCTYPE html>
<html>
<head>
    <title> Test Player v1</title>
    <style>
        body { background: #000; color: #fff; font-family: -apple-system, sans-serif; text-align: center; padding: 50px; }
        .controls { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        button { background: #1c1c1e; color: white; border: 1px solid #333; padding: 15px 25px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        #status { color: #34c759; font-size: 14px; margin-top: 15px; font-family: monospace; }
        .version { position: fixed; bottom: 10px; right: 10px; font-size: 10px; color: #444; }
    </style>
</head>
<body>

    <h2 id="title"> Music Test</h2>
    <div id="status">Ready (v1)</div>

    <div class="controls">
        <button onclick="prev()">Back</button>
        <button id="playBtn" onclick="togglePlay()">PLAY</button>
        <button onclick="next()">Next</button>
    </div>

    <div class="version">Build Version: 1.0.0</div>

<script>
    // 1. Encoded Playlist Data
    const playlist = [
        { name: "Song 1", url: "aHR0cHM6Ly9kbC5kcm9wYm94dXNlcmNvbnRlbnQuY29tL3NjbC9maS91Z3lkdmk4MDNrcDRndTZpZTQ4Y2UvRmlyc3QtS2lzcy1Zby1Zby1Ib25leS1TaW5naC5tcDM/cmxrZXk9dWpkN3lvMzM2cmZvOWptMTIyYW5peXJheSZzdD1sajVzcG8yaCZyYXc9MQ==" }, 
        { name: "Song 2", url: "YOUR_ENCODED_LINK_2" }
    ];

    let currentIndex = 0;
    let audio = new Audio();
    audio.preload = "auto";

    // 2. Lockscreen Resume Fix: Audio context ko zinda rakhne ke liye
    function initAudioContext() {
        if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            if (context.state === 'suspended') {
                context.resume();
            }
        }
    }

    function loadSong(index) {
        currentIndex = index;
        const s = playlist[index];
        document.getElementById('title').innerText = s.name;

        // Hard Reset for Instant Play
        audio.pause();
        audio.src = ""; 
        audio.load(); 

        let decodedURL = atob(s.url);
        audio.src = decodedURL;
        
        setupMediaSession(s.name);
        audio.play().catch(e => console.log("Init required"));
    }

    function setupMediaSession(songName) {
        if ('mediaSession' in navigator) {
            navigator.mediaSession.metadata = new MediaMetadata({
                title: songName,
                artist: " Music v1",
                album: "Lockscreen Fix Test"
            });

            // System handlers: Ye lockscreen play/pause ko control karte hain
            navigator.mediaSession.setActionHandler('play', () => { 
                initAudioContext();
                audio.play(); 
            });
            navigator.mediaSession.setActionHandler('pause', () => { 
                audio.pause(); 
            });
            navigator.mediaSession.setActionHandler('previoustrack', () => { prev(); });
            navigator.mediaSession.setActionHandler('nexttrack', () => { next(); });
        }
    }

    function togglePlay() {
        initAudioContext(); // User interaction par context resume
        if (audio.paused) { audio.play(); } 
        else { audio.pause(); }
    }

    function next() { loadSong((currentIndex + 1) % playlist.length); }
    function prev() { loadSong((currentIndex - 1 + playlist.length) % playlist.length); }

    audio.onplay = () => { document.getElementById('playBtn').innerText = "PAUSE"; };
    audio.onpause = () => { document.getElementById('playBtn').innerText = "PLAY"; };

    loadSong(0);
</script>
</body>
</html>
