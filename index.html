<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cloud Debugger</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; background: #f4f4f7; }
        .box { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: inline-block; }
        #status-log { color: red; font-size: 12px; margin-top: 20px; white-space: pre-wrap; text-align: left; }
        .btn { background: #007aff; color: white; border: none; padding: 15px 30px; border-radius: 10px; cursor: pointer; }
        .btn:disabled { background: #ccc; }
    </style>
</head>
<body>

<div class="box">
    <h2>Cloud Lab Debugger ï£¿</h2>
    <button id="auth_btn" class="btn" onclick="handleAuthClick()" disabled>Connecting to Google...</button>
    <div id="status-log">Log: Initializing...</div>
</div>

<script>
    const log = (msg) => { document.getElementById('status-log').innerText += "\n" + msg; };

    // 1. Manually loading scripts to catch errors
    function loadScript(src) {
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = src;
            script.onload = resolve;
            script.onerror = () => reject("Failed to load: " + src);
            document.head.appendChild(script);
        });
    }

    async function init() {
        try {
            log("Loading Identity Services...");
            await loadScript("https://accounts.google.com/gsi/client");
            log("Identity Services Loaded.");

            log("Loading API Client...");
            await loadScript("https://apis.google.com/js/api.js");
            log("API Client Loaded.");

            setupGoogle();
        } catch (err) {
            log("ERROR: " + err);
            log("TIP: Are you running this via 'http' or 'https'? Google APIs don't work on local files (file://).");
        }
    }

    function setupGoogle() {
        try {
            gapi.load('client:picker', async () => {
                await gapi.client.init({
                    apiKey: 'AIzaSyAtjXuMkQe9UZzWb-cNsztYy0II9StI08U',
                    discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]
                });
                log("GAPI Client Initialized.");
                
                window.tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: '493639014923-7gqsn4g853icgtctj6hhugkcqhm6178e.apps.googleusercontent.com',
                    scope: 'https://www.googleapis.com/auth/drive.readonly',
                    callback: (resp) => { window.accessToken = resp.access_token; openPicker(); }
                });
                
                log("Auth Client Ready.");
                document.getElementById('auth_btn').disabled = false;
                document.getElementById('auth_btn').innerText = "Login & Add Music";
            });
        } catch (e) {
            log("Setup Error: " + e);
        }
    }

    function handleAuthClick() {
        window.tokenClient.requestAccessToken({prompt: 'consent'});
    }

    init();
</script>
</body>
</html>
